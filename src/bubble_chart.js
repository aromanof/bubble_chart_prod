function bubbleChart(){function e(x){var y=d3.max(d3.values(x.data),function(E){return E.quotes.USD.price}),z=d3.max(d3.values(x.data),function(E){return E.quotes.USD.percent_change_24h}),A=d3.min(d3.values(x.data),function(E){return E.quotes.USD.percent_change_24h}),B=d3.scalePow().exponent(0.15).range([2,85]).domain([0,y]),C=[];for(var D in x.data)C.push({radius:B(+x.data[D].quotes.USD.price),id:x.data[D].id,name:x.data[D].name,symbol:x.data[D].symbol,price:x.data[D].quotes.USD.price,group:0>x.data[D].quotes.USD.percent_change_24h?'low':0<x.data[D].quotes.USD.percent_change_24h?'high':'medium',percentChange:x.data[D].quotes.USD.percent_change_24h,marketCap:x.data[D].quotes.USD.market_cap});return C.sort(function(E,F){return F.price-E.price}),C}function g(){u.force('x',d3.forceX().strength(o).x(n.x)),u.alpha(1).restart()}function h(x){d3.select(this).attr('stroke','black');var y='<span class="name">Coin name: </span><span class="value">'+x.name+'</span><br/><span class="name">Current price(USD): </span><span class="value">$'+x.price+'</span><br/><span class="name">Percent change in last 24h: </span><span class="value">'+x.percentChange+'%';'</span>',m.showTooltip(y,d3.event)}function i(x){window.location.href='./tablePage.html?name='+x.name+'&marketCap='+x.marketCap+'&price='+x.price+'&percentChange='+x.percentChange}function j(x){d3.select(this).attr('stroke',d3.rgb(v(x.group)).darker()),m.hideTooltip()}var k=940,l=600,m=floatingTooltip('gates_tooltip',240),n={x:k/2,y:l/2},o=0.03,p=null,q=null,r=null,s=null,t=[],u=d3.forceSimulation().velocityDecay(0.2).force('x',d3.forceX().strength(o).x(n.x)).force('y',d3.forceY().strength(o).y(n.y)).force('charge',d3.forceManyBody().strength(function(x){return-Math.pow(x.radius,2)*o})).on('tick',function(){q.attr('cx',function(x){return x.x}).attr('cy',function(x){return x.y}),r.attr('font-size',function(x){return Math.floor(x.radius)/2}).attr('x',function(x){return x.x-this.getBoundingClientRect().width/2}).attr('y',function(x){return x.y+this.getBoundingClientRect().height/2-5})});u.stop();var v=d3.scaleOrdinal().domain(['low','medium','high']).range(['#d84b2a','#beccae','#7aa25c']);return function(y,z){document.getElementById('toggleButton');t=e(z),p=d3.select(y).append('svg').attr('width',k).attr('height',l),q=p.selectAll('g').data(t,function(C){return C.id}),s=q.enter().append('g');var B=s.append('circle').classed('bubble',!0).attr('r',0).attr('fill',function(C){return v(C.group)}).attr('stroke',function(C){return d3.rgb(v(C.group)).darker()}).attr('stroke-width',2).on('mouseover',h).on('mouseout',j).on('click',i);r=s.append('text').attr('color','black').attr('font-size',15).text(function(C){return C.symbol}).on('click',i),q=q.merge(B),q.transition().duration(2e3).attr('r',function(C){return C.radius}),u.nodes(t),g()}}var myBubbleChart=bubbleChart();function display(c,e){c&&console.log(c),myBubbleChart('#vis',e)}function setupButtons(){d3.select('.button').on('click',function(){var c=document.getElementById('toggleButton');c.classList.toggle('clicked'),d3.json('https://api.coinmarketcap.com/v2/ticker/?limit=50&sort=rank',display)})}d3.json('https://api.coinmarketcap.com/v2/ticker/?limit=50&sort=rank',display),setupButtons();